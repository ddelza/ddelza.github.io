<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§•ì§•ì´ ìœ ì „ ì‹œë®¬ë ˆì´í„°(feat. ë©˜ë¸ì˜ ìœ ì „ë²•ì¹™)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ì„¤ì • --><style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: white; /* ìº”ë²„ìŠ¤ ë°°ê²½ìƒ‰ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }
        /* Custom styles for the creature display: changed to square container */
        .creature-display {
            width: 120px;
            height: 140px; /* Increased height for tentacles */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem; /* Square with rounded corners */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden; 
            background-color: white; /* ì»¨í…Œì´ë„ˆ ë°°ê²½ë„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì • */
        }
        .small-creature-display {
            width: 48px; /* ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
            height: 56px; /* ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            margin-right: 0.5rem;
        }
        /* .red-creature ë° .blue-creature í´ë˜ìŠ¤ëŠ” ë” ì´ìƒ ì»¨í…Œì´ë„ˆ ë°°ê²½ìƒ‰ì„ ì„¤ì •í•˜ëŠ” ë° ì‚¬ìš©ë˜ì§€ ì•ŠìŒ */
        .card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* 1. ìì† ê²°ê³¼ í‘œì‹œ ë° ìŠ¤í¬ë¡¤ ê°œì„  */
        #offspring-grid-container {
            max-height: 400px; /* ìµœëŒ€ ë†’ì´ ì„¤ì • */
            overflow-y: auto; /* ìŠ¤í¬ë¡¤ í™œì„±í™” */
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
        }
        #offspring-grid-container::-webkit-scrollbar {
            width: 8px;
        }
        #offspring-grid-container::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 4px;
        }
        .text-yellow-600 { color: #d97706; } /* Tailwind yellow-600 for 2 eyes */
        .text-green-600 { color: #10b981; } /* Tailwind green-600 for 3 eyes */
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-start justify-center">

    <div id="app" class="w-full max-w-4xl space-y-8">
        <header class="text-center">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">ğŸ§¬ ì§•ì§•ì´ ìœ ì „ ì‹œë®¬ë ˆì´í„° (feat. ë©˜ë¸ì˜ ìœ ì „ë²•ì¹™)</h1>
        </header>

        <!-- NEW: Trait Guide Card -->
        <div id="trait-guide-card" class="card p-4 mb-8 bg-indigo-50 border-indigo-200 border-l-4">
            <h2 class="text-xl font-bold text-indigo-700 mb-3 text-center">ğŸ” ì§•ì§•ì´ í˜•ì§ˆ ê°€ì´ë“œ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Color Trait -->
                <div class="p-3 bg-white rounded-lg border">
                    <h3 class="font-semibold text-lg text-gray-700 mb-2 border-b pb-1">ìƒ‰ê¹” í˜•ì§ˆ (ë¹¨ê°•: R, ìš°ì„± / íŒŒë‘: r, ì—´ì„±)</h3>
                    <div class="flex justify-around items-center space-x-4">
                        <div class="text-center">
                            <div id="guide-color-dom" class="small-creature-display mx-auto mb-1"></div>
                            <p class="text-red-600 font-bold text-sm">R\_ (ìš°ì„±) = ë¹¨ê°•</p>
                        </div>
                        <div class="text-center">
                            <div id="guide-color-rec" class="small-creature-display mx-auto mb-1"></div>
                            <p class="text-blue-600 font-bold text-sm">rr (ì—´ì„±) = íŒŒë‘</p>
                        </div>
                    </div>
                </div>
                <!-- Eye Trait -->
                <div class="p-3 bg-white rounded-lg border">
                    <h3 class="font-semibold text-lg text-gray-700 mb-2 border-b pb-1">ëˆˆ ê°œìˆ˜ í˜•ì§ˆ (ëˆˆ 3ê°œ: T, ìš°ì„± / ëˆˆ 2ê°œ: t, ì—´ì„±)</h3>
                    <div class="flex justify-around items-center space-x-4">
                        <div class="text-center">
                            <div id="guide-eyes-dom" class="small-creature-display mx-auto mb-1"></div>
                            <p class="text-green-600 font-bold text-sm">T\_ (ìš°ì„±) = ëˆˆ 3ê°œ</p>
                        </div>
                        <div class="text-center">
                            <div id="guide-eyes-rec" class="small-creature-display mx-auto mb-1"></div>
                            <p class="text-yellow-600 font-bold text-sm">tt (ì—´ì„±) = ëˆˆ 2ê°œ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END NEW: Trait Guide Card -->

        <!-- Parent Selection and Display --><div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Parent 1 --><div id="parent1-card" class="card space-y-4 md:col-span-1">
                <h2 class="text-2xl font-semibold text-gray-700 text-center">ë¶€ëª¨ 1</h2>
                <div class="flex flex-col items-center space-y-4">
                    <!-- Creature SVG container -->
                    <div id="parent1-creature" class="creature-display"> 
                        <!-- SVG will be injected here --></div>
                    <div class="text-lg font-mono text-gray-800">
                        ìœ ì „ìí˜•: <span id="parent1-genotype" class="font-bold text-red-600">RrTt</span>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-2">
                        <label for="p1-color" class="font-medium text-gray-600 w-1/4">ìƒ‰ê¹” (R/r):</label>
                        <select id="p1-color" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="RR">RR (ë¹¨ê°•)</option>
                            <option value="Rr" selected>Rr (ë¹¨ê°•)</option>
                            <option value="rr">rr (íŒŒë‘)</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label for="p1-eyes" class="font-medium text-gray-600 w-1/4">ëˆˆ (T/t):</label>
                        <select id="p1-eyes" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="TT">TT (3ê°œ)</option>
                            <option value="Tt" selected>Tt (3ê°œ)</option>
                            <option value="tt">tt (2ê°œ)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Breeding Control --><div class="flex flex-col items-center justify-center p-6 space-y-4 md:col-span-1">
                <button id="breed-button" class="w-full md:w-auto px-8 py-3 bg-indigo-600 text-white font-bold rounded-full text-xl hover:bg-indigo-700 transition duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                    êµë°°í•˜ê¸° âœ¨
                </button>
                
                <!-- 3. ì¡°ê±´ë¶€ ëŒ€ëŸ‰ êµë°° ë²„íŠ¼ ì„¹ì…˜ -->
                <div id="bulk-buttons" class="flex flex-col space-y-3 w-full md:w-auto mt-4">
                    <button id="breed-10-button" class="hidden w-full px-4 py-2 bg-purple-500 text-white font-bold rounded-full text-lg hover:bg-purple-600 transition duration-300 disabled:opacity-50" disabled>
                        êµë°°í•˜ê¸° (10ë§ˆë¦¬)
                    </button>
                    <button id="breed-100-button" class="hidden w-full px-4 py-2 bg-pink-500 text-white font-bold rounded-full text-lg hover:bg-pink-600 transition duration-300 disabled:opacity-50" disabled>
                        êµë°°í•˜ê¸° (100ë§ˆë¦¬)
                    </button>
                </div>
                <!-- íŒì—… ë©”ì‹œì§€ ë°•ìŠ¤ëŠ” ì´ì œ í”Œë¡œíŒ… ì„¹ì…˜ìœ¼ë¡œ ì´ë™í–ˆìœ¼ë¯€ë¡œ ì œê±° -->
            </div>

            <!-- Parent 2 --><div id="parent2-card" class="card space-y-4 md:col-span-1">
                <h2 class="text-2xl font-semibold text-gray-700 text-center">ë¶€ëª¨ 2</h2>
                <div class="flex flex-col items-center space-y-4">
                    <!-- Creature SVG container -->
                    <div id="parent2-creature" class="creature-display"> 
                        <!-- SVG will be injected here --></div>
                    <div class="text-lg font-mono text-gray-800">
                        ìœ ì „ìí˜•: <span id="parent2-genotype" class="font-bold text-red-600">RrTt</span>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-2">
                        <label for="p2-color" class="font-medium text-gray-600 w-1/4">ìƒ‰ê¹” (R/r):</label>
                        <select id="p2-color" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="RR">RR (ë¹¨ê°•)</option>
                            <option value="Rr" selected>Rr (ë¹¨ê°•)</option>
                            <option value="rr">rr (íŒŒë‘)</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label for="p2-eyes" class="font-medium text-gray-600 w-1/4">ëˆˆ (T/t):</label>
                        <select id="p2-eyes" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value="TT">TT (3ê°œ)</option>
                            <option value="Tt" selected>Tt (3ê°œ)</option>
                            <option value="tt">tt (2ê°œ)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Offspring Results (Updated to show 4 categories) --><div id="offspring-results" class="card">
            <h2 class="text-2xl font-semibold text-gray-700 text-center mb-4">ìì† ê²°ê³¼</h2>
            
            <!-- 1. ìì† ê²°ê³¼ í‘œì‹œ ë° ìŠ¤í¬ë¡¤ ê°œì„  -->
            <div id="offspring-grid-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4" id="offspring-grid">
                    <p class="text-center text-gray-500 md:col-span-4">êµë°°í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì†ì„ **ë¬´ì œí•œìœ¼ë¡œ** ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
                </div>
            </div>
            
            <!-- NEW CATEGORIZED PHENOTYPE STATS -->
            <div class="mt-8 p-4 border border-gray-200 rounded-xl bg-white shadow-inner">
                <p class="text-center text-lg font-bold text-gray-800 mb-3">ì „ì²´ í‘œí˜„í˜• ë¹„ìœ¨ (ì´ <span id="total-offspring" class="text-indigo-600">0</span>ë§ˆë¦¬)</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <!-- Category 1: Red, 3 eyes (R_ T_) -->
                    <div class="flex flex-col items-center justify-center p-3 bg-red-100 rounded-lg">
                        <p class="text-red-700 font-bold mb-1">1. ë¹¨ê°• (ëˆˆ 3ê°œ)</p>
                        <div class="small-creature-display" id="icon-R_T_"></div>
                        <span class="font-extrabold text-2xl text-red-800" id="count-R_T_">0</span>
                    </div>
                    <!-- Category 2: Red, 2 eyes (R_ tt) -->
                    <div class="flex flex-col items-center justify-center p-3 bg-red-100 rounded-lg">
                        <p class="text-red-700 font-bold mb-1">2. ë¹¨ê°• (ëˆˆ 2ê°œ)</p>
                        <div class="small-creature-display" id="icon-R_tt"></div>
                        <span class="font-extrabold text-2xl text-red-800" id="count-R_tt">0</span>
                    </div>
                    <!-- Category 3: Blue, 3 eyes (rr T_) -->
                    <div class="flex flex-col items-center justify-center p-3 bg-blue-100 rounded-lg">
                        <p class="text-blue-700 font-bold mb-1">3. íŒŒë‘ (ëˆˆ 3ê°œ)</p>
                        <div class="small-creature-display" id="icon-rr_T_"></div>
                        <span class="font-extrabold text-2xl text-blue-800" id="count-rr_T_">0</span>
                    </div>
                    <!-- Category 4: Blue, 2 eyes (rr tt) - Base category -->
                    <div class="flex flex-col items-center justify-center p-3 bg-blue-100 rounded-lg">
                        <p class="text-blue-700 font-bold mb-1">4. íŒŒë‘ (ëˆˆ 2ê°œ)</p>
                        <div class="small-creature-display" id="icon-rr_tt"></div>
                        <span class="font-extrabold text-2xl text-blue-800" id="count-rr_tt">0</span>
                    </div>
                </div>
            </div>
            <!-- END NEW CATEGORIZED PHENOTYPE STATS -->
            
            <!-- NEW RELATIVE RATIO SECTION -->
            <div class="mt-4 p-4 border border-gray-200 rounded-xl bg-gray-50 shadow-inner">
                <p class="text-center text-lg font-bold text-gray-800 mb-3">ìƒëŒ€ í‘œí˜„í˜• ë¹„ìœ¨ (<span class="font-mono text-gray-600">ìµœì†Œ ê°œìˆ˜ ì¹´í…Œê³ ë¦¬</span> = 1.00 ê¸°ì¤€)</p>
                <div class="grid grid-cols-4 gap-4 text-center font-bold text-xl">
                    <div class="flex flex-col">
                        <span class="text-red-700 mb-1">ë¹¨ê°•/3ê°œ</span>
                        <span id="ratio-R_T_" class="font-mono text-gray-800">0.00</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-red-700 mb-1">ë¹¨ê°•/2ê°œ</span>
                        <span id="ratio-R_tt" class="font-mono text-gray-800">0.00</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-blue-700 mb-1">íŒŒë‘/3ê°œ</span>
                        <span id="ratio-rr_T_" class="font-mono text-gray-800">0.00</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-blue-700 mb-1">íŒŒë‘/2ê°œ</span>
                        <span id="ratio-rr_tt" class="font-mono text-gray-800">0.00</span>
                    </div>
                </div>
                <p id="ratio-basis-info" class="text-center text-xs text-gray-500 mt-2">
                    í˜„ì¬ ê¸°ì¤€: í‘œí˜„í˜• ì¹´í…Œê³ ë¦¬ê°€ 0ë³´ë‹¤ í° ê²½ìš° ì¤‘ ìµœì†Œ ê°œìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                </p>
            </div>
            <!-- END RELATIVE RATIO SECTION -->
            
            <!-- 2. ì´ˆê¸°í™” ë²„íŠ¼ ì¶”ê°€ -->
            <div class="flex justify-center pt-6 pb-2">
                <button id="reset-button" class="px-6 py-2 bg-gray-200 text-gray-700 font-bold rounded-full hover:bg-gray-300 transition duration-200">
                    ğŸ§² ì´ˆê¸°í™” (ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°)
                </button>
            </div>
            
        </div>
        
        <!-- NEW FLOATING MESSAGE BOX -->
        <div id="floating-message-box" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 p-3 text-white rounded-lg shadow-xl text-center z-50 transition-opacity duration-500 opacity-0 pointer-events-none">
            <div id="message-box-content"></div>
        </div>

    </div>

    <script>
        // ì „ì—­ ìƒíƒœ ë³€ìˆ˜
        const TRAITS = {
            COLOR: {
                allele1: 'R', // Dominant for Red
                allele2: 'r', // Recessive for Blue
                dominantPhenotype: 'ë¹¨ê°•',
                recessivePhenotype: 'íŒŒë‘',
                dominantColorHex: '#f87171',
                recessiveColorHex: '#60a5fa',
                dominantStyle: 'red-creature',
                recessiveStyle: 'blue-creature',
            },
            EYES: {
                allele1: 'T', // Dominant for Three Eyes
                allele2: 't', // Recessive for Two Eyes
                dominantPhenotype: 'ëˆˆ 3ê°œ',
                recessivePhenotype: 'ëˆˆ 2ê°œ',
            }
        };

        // í‘œí˜„í˜• 4ê°€ì§€ ì¹´í…Œê³ ë¦¬ë¡œ í†µê³„ ì¬ì •ì˜
        let offspringStats = {
            total: 0,
            R_T_: 0, // Red, 3 eyes (R_ T_)
            R_tt: 0, // Red, 2 eyes (R_ tt)
            rr_T_: 0, // Blue, 3 eyes (rr T_)
            rr_tt: 0  // Blue, 2 eyes (rr tt)
        };
        
        // 2. ìŠ¤í˜ì´ìŠ¤ë°”/ë§ˆìš°ìŠ¤ ì—°ì† êµë°°ë¥¼ ìœ„í•œ ë³€ìˆ˜
        let isSpacePressed = false;
        let breedInterval = null;
        
        let isMousePressed = false; // ë§ˆìš°ìŠ¤ ê¾¹ ëˆ„ë¥´ê¸° ìƒíƒœ ë³€ìˆ˜
        let mouseBreedInterval = null; // ë§ˆìš°ìŠ¤ ê¾¹ ëˆ„ë¥´ê¸° ì¸í„°ë²Œ
        const SINGLE_BREED_DELAY = 100; // 1ë§ˆë¦¬ êµë°° ë”œë ˆì´ (100ms)
        const BULK_BREED_DELAY = 250;  // 10ë§ˆë¦¬/100ë§ˆë¦¬ êµë°° ë”œë ˆì´ (250ms)

        // DOM ìš”ì†Œ ìºì‹œ
        const p1ColorSelect = document.getElementById('p1-color');
        const p1EyesSelect = document.getElementById('p1-eyes'); 
        const p2ColorSelect = document.getElementById('p2-color');
        const p2EyesSelect = document.getElementById('p2-eyes'); 
        
        const parent1CreatureDiv = document.getElementById('parent1-creature');
        const parent2CreatureDiv = document.getElementById('parent2-creature');
        const p1GenotypeDisplay = document.getElementById('parent1-genotype');
        const p2GenotypeDisplay = document.getElementById('parent2-genotype');

        const offspringGrid = document.getElementById('offspring-grid');
        const breedButton = document.getElementById('breed-button');
        const totalOffspringSpan = document.getElementById('total-offspring');
        const resetButton = document.getElementById('reset-button'); // ì´ˆê¸°í™” ë²„íŠ¼
        
        // 1. ë©”ì‹œì§€ ë°•ìŠ¤ DOM ìš”ì†Œ ë³€ê²½
        const floatingMessageBox = document.getElementById('floating-message-box');
        const messageBoxContent = document.getElementById('message-box-content');
        
        // ìƒˆë¡œìš´ í†µê³„ ì¹´ìš´í„° DOM ìš”ì†Œ
        const countR_T_Span = document.getElementById('count-R_T_');
        const countR_ttSpan = document.getElementById('count-R_tt');
        const countrr_T_Span = document.getElementById('count-rr_T_');
        const countrr_ttSpan = document.getElementById('count-rr_tt');
        
        // ìƒˆë¡œìš´ ìƒëŒ€ ë¹„ìœ¨ DOM ìš”ì†Œ
        const ratioR_T_Span = document.getElementById('ratio-R_T_');
        const ratioR_ttSpan = document.getElementById('ratio-R_tt');
        const ratiorr_T_Span = document.getElementById('ratio-rr_T_');
        const ratiorr_ttSpan = document.getElementById('ratio-rr_tt');
        const ratioBasisInfo = document.getElementById('ratio-basis-info'); // ê¸°ì¤€ ì •ë³´ í‘œì‹œ
        
        // 3. ëŒ€ëŸ‰ êµë°° ë²„íŠ¼ DOM ìš”ì†Œ
        const breed10Button = document.getElementById('breed-10-button');
        const breed100Button = document.getElementById('breed-100-button');
        
        // ìƒˆë¡œìš´ í˜•ì§ˆ ê°€ì´ë“œ DOM ìš”ì†Œ
        const guideColorDomDiv = document.getElementById('guide-color-dom');
        const guideColorRecDiv = document.getElementById('guide-color-rec');
        const guideEyesDomDiv = document.getElementById('guide-eyes-dom');
        const guideEyesRecDiv = document.getElementById('guide-eyes-rec');


        /**
         * ìœ ì „ìí˜•ì— ë”°ë¼ ìƒëª…ì²´ì˜ ë„íŠ¸ ìŠ¤íƒ€ì¼ SVG ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function generateCreatureSVG(colorGenotype, eyesGenotype, isSmall = false) {
            // 1. Color Phenotype (R is dominant)
            const isRed = colorGenotype.includes(TRAITS.COLOR.allele1);
            const bodyColor = isRed ? TRAITS.COLOR.dominantColorHex : TRAITS.COLOR.recessiveColorHex;
            
            // 2. Eyes Phenotype (T is dominant)
            const isThreeEyes = eyesGenotype.includes(TRAITS.EYES.allele1);
            const eyeColor = "#000";
            
            // Adjust size based on container (for small offspring grid)
            const scale = isSmall ? 0.6 : 1; // ì•„ì´ì½˜ í¬ê¸°ì— ë§ì¶° scale ì¡°ì •
            
            // NEW: Use 100x120 viewBox to accommodate tentacles and square body
            let svg = `
                <svg viewBox="0 0 100 120" class="w-full h-full" xmlns="http://www.w3.org/2000/svg" style="transform: scale(${scale});">
                    <!-- Body (Square with slightly rounded corners - 80x80). ì´ ë¶€ë¶„ë§Œ ìƒ‰ê¹”ì´ ì¹ í•´ì§‘ë‹ˆë‹¤. -->
                    <rect x="10" y="10" width="80" height="80" rx="10" ry="10" fill="${bodyColor}" stroke="#333" stroke-width="4" />
                    
                    <!-- Cheeks/Spots (Pixel dots) - Adjusted Y -->
                    <circle cx="28" cy="60" r="3" fill="#ffffff" opacity="0.4"/>
                    <circle cx="72" cy="60" r="3" fill="#ffffff" opacity="0.4"/>

                    <!-- Face Features -->
                    <!-- Nose (Simple dot) - Adjusted Y -->
                    <circle cx="50" cy="55" r="3" fill="#333"/>
                    <!-- Mouth (Cute smile) - Adjusted Y -->
                    <path d="M 40 65 Q 50 73 60 65" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>

                    <!-- Eye 1 (Left - moved to forehead) - Adjusted Y -->
                    <circle cx="30" cy="40" r="5" fill="${eyeColor}"/>
                    
                    <!-- Eye 2 (Right - moved to forehead) - Adjusted Y -->
                    <circle cx="70" cy="40" r="5" fill="${eyeColor}"/>
            `;
            
            // Eye 3 (Center - if Dominant T is present - moved to forehead) - Adjusted Y
            if (isThreeEyes) {
                svg += `
                    <circle cx="50" cy="35" r="5" fill="${eyeColor}"/>
                `;
            }
            
            // 8 Tentacles (Pixelated lines from bottom)
            const tentacleCount = 8;
            const length = 20; // Length of tentacles
            const spread = 70; // Horizontal spread
            const baseCx = 50;
            const bodyBottom = 90; // Y coordinate of the bottom of the square body (10 + 80)

            for (let i = 0; i < tentacleCount; i++) {
                // Spread the tentacles slightly below the body
                const startX = baseCx + (i - (tentacleCount - 1) / 2) * (spread / tentacleCount) * 0.9;
                const endX = startX + (i - (tentacleCount - 1) / 2) * (spread / tentacleCount) * 0.2; 
                const endY = bodyBottom + length; // Extend tentacles to Y=110 (within 120 viewBox)
                
                svg += `<line x1="${startX}" y1="${bodyBottom}" x2="${endX}" y2="${endY}" stroke="#333" stroke-width="3" stroke-linecap="round"/>`;
            }

            svg += '</svg>';
            return svg;
        }


        /**
         * ë¶€ëª¨ì˜ ì„ íƒì— ë”°ë¼ ìœ ì „ìí˜•ì„ ì—…ë°ì´íŠ¸í•˜ê³  í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function updateParentDisplay(parentNum) {
            let colorGenotype, eyesGenotype, creatureDiv, genotypeDisplay;

            if (parentNum === 1) {
                colorGenotype = p1ColorSelect.value;
                eyesGenotype = p1EyesSelect.value;
                creatureDiv = parent1CreatureDiv;
                genotypeDisplay = p1GenotypeDisplay;
            } else {
                colorGenotype = p2ColorSelect.value;
                eyesGenotype = p2EyesSelect.value;
                creatureDiv = parent2CreatureDiv;
                genotypeDisplay = p2GenotypeDisplay;
            }

            const fullGenotype = colorGenotype + eyesGenotype;
            genotypeDisplay.textContent = fullGenotype;

            // 1. Color Phenotype (R is dominant)
            const isRed = colorGenotype.includes(TRAITS.COLOR.allele1);

            // Update container class: ìƒ‰ê¹” í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ê³  ê¸°ë³¸ 'creature-display'ë§Œ ìœ ì§€
            creatureDiv.className = `creature-display`;

            // Update genotype text color
            if (isRed) {
                genotypeDisplay.classList.add('text-red-600');
                genotypeDisplay.classList.remove('text-blue-600');
            } else { 
                genotypeDisplay.classList.remove('text-red-600');
                genotypeDisplay.classList.add('text-blue-600');
            }

            // 2. Render SVG
            creatureDiv.innerHTML = generateCreatureSVG(colorGenotype, eyesGenotype, false);
        }

        /**
         * ì£¼ì–´ì§„ ìœ ì „ìí˜•ì—ì„œ ê°€ëŠ¥í•œ ë°°ìš°ì(gamete)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ë¶„ë¦¬ì˜ ë²•ì¹™)
         */
        function getGametes(colorGenotype, eyesGenotype) {
            const colorAlleles = [...new Set(colorGenotype)];
            const eyesAlleles = [...new Set(eyesGenotype)];
            const gametes = [];

            // ë…ë¦½ì˜ ë²•ì¹™ ì ìš© (ë‘ íŠ¹ì„±ì´ ë…ë¦½ì ìœ¼ë¡œ ìœ ì „)
            for (const c of colorAlleles) {
                for (const a of eyesAlleles) {
                    gametes.push(c + a);
                }
            }
            return gametes;
        }

        /**
         * ë‹¨ì¼ ìì†ì„ ìƒì„±í•˜ê³  í†µê³„ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function generateSingleOffspring() {
            const p1Color = p1ColorSelect.value;
            const p1Eyes = p1EyesSelect.value;
            const p2Color = p2ColorSelect.value;
            const p2Eyes = p2EyesSelect.value;

            // 1. ë°°ìš°ì ìƒì„± (ë¶„ë¦¬ ë²•ì¹™)
            const p1Gametes = getGametes(p1Color, p1Eyes);
            const p2Gametes = getGametes(p2Color, p2Eyes);
            
            // 2. ëœë¤ ë°°ìš°ì ì„ íƒ
            const p1Gamete = p1Gametes[Math.floor(Math.random() * p1Gametes.length)];
            const p2Gamete = p2Gametes[Math.floor(Math.random() * p2Gametes.length)];

            // 3. ìì† ìœ ì „ìí˜• ì¡°í•©
            const offspringColorAlleles = [p1Gamete[0], p2Gamete[0]].sort();
            const offspringColorGenotype = offspringColorAlleles.join('');
            
            const offspringEyesAlleles = [p1Gamete[1], p2Gamete[1]].sort();
            const offspringEyesGenotype = offspringEyesAlleles.join('');
            
            const offspringGenotype = offspringColorGenotype + offspringEyesGenotype;

            // 4. í†µê³„ ì—…ë°ì´íŠ¸
            updateStats(offspringGenotype);

            // 5. ê²°ê³¼ í‘œì‹œ (10ê°œë§Œ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ)
            displayOffspring(offspringGenotype);
        }
        
        /**
         * êµë°° ë²„íŠ¼ì˜ ì£¼ ê¸°ëŠ¥: ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ ìì†ì„ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function breedOffspring(count = 1) {
            let lastMessage = '';
            try {
                for (let i = 0; i < count; i++) {
                    generateSingleOffspring();
                }
                
                // 3. ëŒ€ëŸ‰ êµë°° ë²„íŠ¼ í™œì„±í™” ì¡°ê±´ ì²´í¬
                checkBulkButtonActivation();

                if (count === 1) {
                    lastMessage = 'ìƒˆë¡œìš´ ìì†ì´ íƒœì–´ë‚¬ìŠµë‹ˆë‹¤!';
                } else {
                    lastMessage = `${count}ë§ˆë¦¬ì˜ ìì†ì´ ë¹ ë¥´ê²Œ íƒœì–´ë‚¬ìŠµë‹ˆë‹¤!`;
                }

                showMessage(lastMessage);
            } catch (error) {
                console.error("Breeding failed:", error);
                showMessage('êµë°° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', true);
            }
        }


        /**
         * ìœ ì „ìí˜•ì„ ê¸°ë°˜ìœ¼ë¡œ 4ê°€ì§€ í‘œí˜„í˜• ì¹´í…Œê³ ë¦¬ í†µê³„ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {string} genotype - ìì†ì˜ ìœ ì „ìí˜• (ì˜ˆ: RrTt)
         */
        function updateStats(genotype) {
            offspringStats.total++;
            
            const colorGenotype = genotype.substring(0, 2);
            const eyesGenotype = genotype.substring(2, 4);
            
            const isRed = colorGenotype.includes(TRAITS.COLOR.allele1); // R
            const isThreeEye = eyesGenotype.includes(TRAITS.EYES.allele1); // T

            let categoryKey;

            if (isRed && isThreeEye) {
                categoryKey = 'R_T_';
            } else if (isRed && !isThreeEye) {
                categoryKey = 'R_tt';
            } else if (!isRed && isThreeEye) {
                categoryKey = 'rr_T_';
            } else { // !isRed && !isThreeEye (rr tt)
                categoryKey = 'rr_tt';
            }
            
            offspringStats[categoryKey]++;
            
            // Update display spans for the 4 categories
            totalOffspringSpan.textContent = offspringStats.total;
            countR_T_Span.textContent = offspringStats.R_T_;
            countR_ttSpan.textContent = offspringStats.R_tt;
            countrr_T_Span.textContent = offspringStats.rr_T_;
            countrr_ttSpan.textContent = offspringStats.rr_tt;
            
            // Update relative ratios
            updateRelativeRatios();
        }

        /**
         * 'ì „ì²´ í‘œí˜„í˜• ì¤‘ ê°œìˆ˜ê°€ 0ë³´ë‹¤ í° ê²ƒ ì¤‘ ê°€ì¥ ì‘ì€ ê°œìˆ˜'ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ì—¬ ìƒëŒ€ ë¹„ìœ¨ì„ ê³„ì‚°í•˜ê³  í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function updateRelativeRatios() {
            const ratios = {
                R_T_: offspringStats.R_T_,
                R_tt: offspringStats.R_tt,
                rr_T_: offspringStats.rr_T_,
                rr_tt: offspringStats.rr_tt
            };

            const ratioElements = {
                R_T_: ratioR_T_Span,
                R_tt: ratioR_ttSpan,
                rr_T_: ratiorr_T_Span,
                rr_tt: ratiorr_ttSpan
            };
            
            const phenotypeLabels = {
                R_T_: 'ë¹¨ê°•/3ê°œ', R_tt: 'ë¹¨ê°•/2ê°œ', rr_T_: 'íŒŒë‘/3ê°œ', rr_tt: 'íŒŒë‘/2ê°œ'
            };

            const nonZeroCounts = Object.entries(ratios)
                                      .filter(([key, count]) => count > 0)
                                      .map(([key, count]) => ({ key, count }));

            if (offspringStats.total === 0) {
                // ì´ˆê¸° ìƒíƒœ
                Object.values(ratioElements).forEach(el => el.textContent = '0.00');
                ratioBasisInfo.textContent = 'í˜„ì¬ ê¸°ì¤€: êµë°° ì „';
                return;
            }

            if (nonZeroCounts.length === 0) {
                 // ì´ë¡ ì ìœ¼ë¡œ ì´ ê°œìˆ˜ê°€ 0ë³´ë‹¤ í¬ë©´ ë°œìƒí•  ìˆ˜ ì—†ì§€ë§Œ, ì•ˆì „ì„ ìœ„í•´ ì²˜ë¦¬
                Object.values(ratioElements).forEach(el => el.textContent = 'N/A');
                ratioBasisInfo.textContent = 'í˜„ì¬ ê¸°ì¤€: ë°ì´í„° ë¶€ì¡±';
                return;
            }

            // 2. ê°€ì¥ ì‘ì€ ê°œìˆ˜ (ê¸°ì¤€ ë¶„ëª¨) ì°¾ê¸°
            const minEntry = nonZeroCounts.reduce((min, current) => 
                current.count < min.count ? current : min, nonZeroCounts[0]);
            
            const baseCount = minEntry.count;
            const baseKey = minEntry.key;
            
            // ê¸°ì¤€ ì •ë³´ ì—…ë°ì´íŠ¸
            const baseLabel = phenotypeLabels[baseKey];
            ratioBasisInfo.textContent = `í˜„ì¬ ê¸°ì¤€: ${baseLabel} (${baseCount}ë§ˆë¦¬)`;

            // 1. ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ ê³„ì‚° ë° í‘œì‹œ
            for (const key in ratios) {
                if (ratios[key] > 0) {
                    const ratio = ratios[key] / baseCount;
                    ratioElements[key].textContent = ratio.toFixed(2);
                } else {
                    ratioElements[key].textContent = '0.00';
                }
            }
        }

        /**
         * ìì†ì˜ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function displayOffspring(genotype) {
            // Remove initial message if it exists
            const initialMessage = offspringGrid.querySelector('p');
            
            // [ì˜¤ë¥˜ ìˆ˜ì •]: ì„ íƒëœ ìš”ì†Œ(initialMessage)ê°€ offspringGridì˜ ì§ê³„ ìì†ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
            if (initialMessage && initialMessage.parentElement === offspringGrid) {
                offspringGrid.removeChild(initialMessage);
            }
            
            // Separate genotypes for SVG rendering
            const colorGenotype = genotype.substring(0, 2);
            const eyesGenotype = genotype.substring(2, 4);

            const offspringDiv = document.createElement('div');
            // 'flex-col items-center' í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ì—¬ ì¸ë¼ì¸ìœ¼ë¡œ ë°°ì¹˜ë˜ë„ë¡ í•¨
            offspringDiv.className = 'p-3 border border-gray-100 rounded-lg bg-gray-50 space-y-2 transform hover:shadow-md transition duration-200';
            offspringDiv.style.animation = 'fadeIn 0.5s ease-out';
            offspringDiv.style.display = 'flex';
            offspringDiv.style.flexDirection = 'column';
            offspringDiv.style.alignItems = 'center';

            const creatureDiv = document.createElement('div');
            // ìƒ‰ê¹” í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ê³  ê¸°ë³¸ í´ë˜ìŠ¤ë§Œ ìœ ì§€
            creatureDiv.className = `creature-display small-creature-display`; 
            creatureDiv.innerHTML = generateCreatureSVG(colorGenotype, eyesGenotype, true); // Render small SVG
            
            const genotypeP = document.createElement('p');
            genotypeP.className = 'text-sm font-mono font-bold text-gray-800';
            genotypeP.textContent = genotype;

            offspringDiv.appendChild(creatureDiv);
            offspringDiv.appendChild(genotypeP);

            // Add to grid (prepend to show newest first)
            offspringGrid.prepend(offspringDiv);

            // 1. ìì† ê²°ê³¼ê°€ í•œ ë²ˆì— 10ê°œì”© ë³´ì´ë„ë¡ í•©ë‹ˆë‹¤.
            // (ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ì„ í†µí•´ ì´ì „ ìì†ë„ ë³¼ ìˆ˜ ìˆë„ë¡ ì œí•œ ë¡œì§ì€ ì œê±°)
        }
        
        /**
         * 3. ëŒ€ëŸ‰ êµë°° ë²„íŠ¼ í™œì„±í™” ì¡°ê±´ ì²´í¬ ë° ì—…ë°ì´íŠ¸
         */
        function checkBulkButtonActivation() {
            const total = offspringStats.total;

            // 10ë§ˆë¦¬ êµë°° ë²„íŠ¼ (ì´ 100ë§ˆë¦¬ ì´ìƒì¼ ë•Œ í™œì„±í™”)
            if (total >= 100 && breed10Button.hasAttribute('disabled')) {
                breed10Button.classList.remove('hidden');
                breed10Button.removeAttribute('disabled');
                showMessage('10ë§ˆë¦¬ ë™ì‹œ êµë°° ë²„íŠ¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', false);
            } else if (total < 100 && !breed10Button.hasAttribute('disabled')) {
                // ì´ìŠ¤í„°ì—ê·¸ì´ë¯€ë¡œ ë¹„í™œì„±í™”ëŠ” í•˜ì§€ ì•ŠìŒ. ë‹¤ë§Œ ì²˜ìŒì—ëŠ” hidden ìƒíƒœë¡œ ì‹œì‘í•¨.
            }
            
            // 100ë§ˆë¦¬ êµë°° ë²„íŠ¼ (ì´ 1000ë§ˆë¦¬ ì´ìƒì¼ ë•Œ í™œì„±í™”)
            if (total >= 1000 && breed100Button.hasAttribute('disabled')) {
                breed100Button.classList.remove('hidden');
                breed100Button.removeAttribute('disabled');
                showMessage('100ë§ˆë¦¬ ë™ì‹œ êµë°° ë²„íŠ¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', false);
            } else if (total < 1000 && !breed100Button.hasAttribute('disabled')) {
                // ì´ìŠ¤í„°ì—ê·¸ì´ë¯€ë¡œ ë¹„í™œì„±í™”ëŠ” í•˜ì§€ ì•ŠìŒ. ë‹¤ë§Œ ì²˜ìŒì—ëŠ” hidden ìƒíƒœë¡œ ì‹œì‘í•¨.
            }

            // ì´ˆê¸° ìƒíƒœì—ì„œëŠ” ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (total === 0) {
                breed10Button.classList.add('hidden');
                breed100Button.classList.add('hidden');
            }
        }

        /**
         * 4ê°€ì§€ ëŒ€í‘œ í‘œí˜„í˜• ì•„ì´ì½˜ì„ ì´ˆê¸° í™”ë©´ì— ë Œë”ë§í•©ë‹ˆë‹¤. (í†µê³„ìš©)
         */
        function initializeOffspringIcons() {
            // 1. ë¹¨ê°• (ëˆˆ 3ê°œ) - ì˜ˆì‹œ ìœ ì „ìí˜•: RrTt
            document.getElementById('icon-R_T_').innerHTML = generateCreatureSVG('Rr', 'Tt', true);
            // 2. ë¹¨ê°• (ëˆˆ 2ê°œ) - ì˜ˆì‹œ ìœ ì „ìí˜•: Rrtt
            document.getElementById('icon-R_tt').innerHTML = generateCreatureSVG('Rr', 'tt', true);
            // 3. íŒŒë‘ (ëˆˆ 3ê°œ) - ì˜ˆì‹œ ìœ ì „ìí˜•: rrTt
            document.getElementById('icon-rr_T_').innerHTML = generateCreatureSVG('rr', 'Tt', true);
            // 4. íŒŒë‘ (ëˆˆ 2ê°œ) - ì˜ˆì‹œ ìœ ì „ìí˜•: rrtt
            document.getElementById('icon-rr_tt').innerHTML = generateCreatureSVG('rr', 'tt', true);
        }

        /**
         * ìƒˆë¡œìš´ í˜•ì§ˆ ê°€ì´ë“œ ì•„ì´ì½˜ì„ ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function initializeTraitGuideIcons() {
            // Color Guide
            // R_ (Red, Dominant) - Use Rrtt as a representative (ë¹¨ê°•, ëˆˆ 2ê°œ)
            guideColorDomDiv.innerHTML = generateCreatureSVG('Rr', 'tt', true);
            // rr (Blue, Recessive) - Use rrtt as a representative (íŒŒë‘, ëˆˆ 2ê°œ)
            guideColorRecDiv.innerHTML = generateCreatureSVG('rr', 'tt', true);
            
            // Eyes Guide
            // T_ (3 Eyes, Dominant) - Use rrTt as a representative (íŒŒë‘, ëˆˆ 3ê°œ)
            guideEyesDomDiv.innerHTML = generateCreatureSVG('rr', 'Tt', true);
            // tt (2 Eyes, Recessive) - Use rrtt as a representative (íŒŒë‘, ëˆˆ 2ê°œ)
            guideEyesRecDiv.innerHTML = generateCreatureSVG('rr', 'tt', true);
        }
        
        /**
         * 1. í”Œë¡œíŒ… ë©”ì‹œì§€ ë°•ìŠ¤ì— ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function showMessage(text, isError = false) {
            // ëª¨ë“  ì´ì „ ë°°ê²½ í´ë˜ìŠ¤ ì œê±°
            floatingMessageBox.classList.remove('bg-red-600', 'bg-green-600');
            
            messageBoxContent.textContent = text;
            floatingMessageBox.classList.add(isError ? 'bg-red-600' : 'bg-green-600');
            
            // í”Œë¡œíŒ… ë©”ì‹œì§€ ë°•ìŠ¤ë¥¼ ë³´ì´ê²Œ í•¨
            floatingMessageBox.classList.add('opacity-100', 'pointer-events-auto');
            floatingMessageBox.classList.remove('opacity-0', 'pointer-events-none');

            // 3ì´ˆ í›„ ìˆ¨ê¹€ ì²˜ë¦¬
            setTimeout(() => {
                floatingMessageBox.classList.remove('opacity-100', 'pointer-events-auto');
                floatingMessageBox.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }

        /**
         * 2. ìŠ¤í˜ì´ìŠ¤ë°” ì—°ì† êµë°°ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
         */
        function handleKeyDown(event) {
            if (event.code === 'Space' && !isSpacePressed) {
                isSpacePressed = true;
                
                // ìŠ¤í˜ì´ìŠ¤ë°”ëŠ” ê¸°ë³¸ 1ë§ˆë¦¬ êµë°° ì†ë„ ì‚¬ìš©
                breedOffspring(1); 
                breedInterval = setInterval(() => {
                    if (isSpacePressed) breedOffspring(1);
                }, SINGLE_BREED_DELAY);
                event.preventDefault(); // ìŠ¤í˜ì´ìŠ¤ë°”ì˜ ê¸°ë³¸ ë™ì‘ (ìŠ¤í¬ë¡¤) ë°©ì§€
            }
        }

        function handleKeyUp(event) {
            if (event.code === 'Space') {
                isSpacePressed = false;
                clearInterval(breedInterval);
            }
        }
        
        /**
         * 2. ë§ˆìš°ìŠ¤ ê¾¹ ëˆ„ë¥´ê¸° ì—°ì† êµë°° í•¸ë“¤ëŸ¬
         * @param {number} count - í•œ ë²ˆì— ìƒì„±í•  ìì† ìˆ˜
         */
        function handleMouseDown(event, count) {
            // ì™¼ìª½ ë²„íŠ¼ (0) í´ë¦­ì¼ ê²½ìš°ì—ë§Œ ì‘ë™
            if (event.button === 0 && !isMousePressed) { 
                isMousePressed = true;
                
                // ë”œë ˆì´ ì„¤ì • (1ë§ˆë¦¬ëŠ” 100ms, ëŒ€ëŸ‰ì€ 250ms)
                const delay = count === 1 ? SINGLE_BREED_DELAY : BULK_BREED_DELAY;
                
                breedOffspring(count); // ìµœì´ˆ í•œ ë²ˆ ì‹¤í–‰
                mouseBreedInterval = setInterval(() => {
                    if (isMousePressed) { 
                        breedOffspring(count);
                    } else {
                        clearInterval(mouseBreedInterval);
                    }
                }, delay);
                // ë§ˆìš°ìŠ¤ í´ë¦­ì˜ ê¸°ë³¸ ë™ì‘(ë“œë˜ê·¸ ë“±) ë°©ì§€
                event.preventDefault(); 
            }
        }

        function handleMouseUp() {
            if (isMousePressed) {
                isMousePressed = false;
                clearInterval(mouseBreedInterval);
            }
        }
        
        /**
         * 2. ì´ˆê¸°í™” í•¨ìˆ˜
         */
        function resetSimulator() {
            // í†µê³„ ì´ˆê¸°í™”
            offspringStats = { total: 0, R_T_: 0, R_tt: 0, rr_T_: 0, rr_tt: 0 };
            
            // í™”ë©´ ìš”ì†Œ ì´ˆê¸°í™”
            // ìì† ëª©ë¡ ë¹„ìš°ê¸°
            offspringGrid.innerHTML = '<p class="text-center text-gray-500 md:col-span-4">êµë°°í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì†ì„ **ë¬´ì œí•œìœ¼ë¡œ** ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>';
            
            // í†µê³„ ì—…ë°ì´íŠ¸ (ëª¨ë‘ 0ìœ¼ë¡œ ì„¤ì •)
            totalOffspringSpan.textContent = '0';
            countR_T_Span.textContent = '0';
            countR_ttSpan.textContent = '0';
            countrr_T_Span.textContent = '0';
            countrr_ttSpan.textContent = '0';
            updateRelativeRatios(); // ë¹„ìœ¨ë„ N/A ë˜ëŠ” 0.0ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            
            // ëŒ€ëŸ‰ êµë°° ë²„íŠ¼ ìˆ¨ê¸°ê¸° ë° ë¹„í™œì„±í™”
            breed10Button.classList.add('hidden');
            breed10Button.setAttribute('disabled', 'true');
            breed100Button.classList.add('hidden');
            breed100Button.setAttribute('disabled', 'true');
            
            showMessage('ì‹œë®¬ë ˆì´ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', false);
        }


        /**
         * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ë° ì´ˆê¸°í™”
         */
        window.onload = function() {
            // ë¶€ëª¨ ì„ íƒ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
            p1ColorSelect.addEventListener('change', () => updateParentDisplay(1));
            p1EyesSelect.addEventListener('change', () => updateParentDisplay(1));
            p2ColorSelect.addEventListener('change', () => updateParentDisplay(2));
            p2EyesSelect.addEventListener('change', () => updateParentDisplay(2));

            // 2. ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            resetButton.addEventListener('click', resetSimulator);

            // êµë°° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë° ë§ˆìš°ìŠ¤ ì—°ì† êµë°° ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            
            // 1ë§ˆë¦¬ êµë°° ë²„íŠ¼
            breedButton.addEventListener('click', () => breedOffspring(1));
            breedButton.addEventListener('mousedown', (e) => handleMouseDown(e, 1));
            
            // 10ë§ˆë¦¬ êµë°° ë²„íŠ¼
            breed10Button.addEventListener('click', () => breedOffspring(10));
            breed10Button.addEventListener('mousedown', (e) => handleMouseDown(e, 10));
            
            // 100ë§ˆë¦¬ êµë°° ë²„íŠ¼
            breed100Button.addEventListener('click', () => breedOffspring(100));
            breed100Button.addEventListener('mousedown', (e) => handleMouseDown(e, 100));
            
            // ë§ˆìš°ìŠ¤ ë–¼ê¸°/ë– ë‚˜ê¸° ì´ë²¤íŠ¸ëŠ” ëª¨ë“  ë²„íŠ¼ì— ê³µí†µ ì ìš©
            document.addEventListener('mouseup', handleMouseUp); 
            
            [breedButton, breed10Button, breed100Button].forEach(btn => {
                btn.addEventListener('mouseleave', () => {
                    // ë²„íŠ¼ ì˜ì—­ì„ ë²—ì–´ë‚¬ì„ ë•Œë„ ì—°ì† êµë°° ì¤‘ì§€ (ì•ˆì „ ì¥ì¹˜)
                    if (isMousePressed) handleMouseUp();
                });
            });
            
            // 2. ìŠ¤í˜ì´ìŠ¤ë°” ì—°ì† êµë°° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // ì´ˆê¸° ë””ìŠ¤í”Œë ˆì´ ì„¤ì •
            updateParentDisplay(1);
            updateParentDisplay(2);
            initializeOffspringIcons(); // ì´ˆê¸° í‘œí˜„í˜• ì•„ì´ì½˜ ë Œë”ë§ (í†µê³„ìš©)
            initializeTraitGuideIcons(); // í˜•ì§ˆ ê°€ì´ë“œ ì•„ì´ì½˜ ë Œë”ë§ (ìƒë‹¨ ê°€ì´ë“œìš©)
            updateRelativeRatios(); // ì´ˆê¸° ìƒëŒ€ ë¹„ìœ¨ ë Œë”ë§ (0.0ìœ¼ë¡œ)
            checkBulkButtonActivation(); // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ í™•ì¸ (ëª¨ë‘ ìˆ¨ê¹€/ë¹„í™œì„±í™”)
        }
        
        // CSS for fade-in animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>
